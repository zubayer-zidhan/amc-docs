# Database Population Documentation

This documentation explains how to populate various tables in the database using different methods.



- [Database Population Documentation](#database-population-documentation)
  - [API-Based Population](#api-based-population)
    - [Users Table](#users-table)
  - [Excel Based Population](#excel-based-population)
    - [Parts Table](#parts-table)
    - [AMC Table](#amc-table)


## API-Based Population

### Users Table

To populate the "users" table via the API, follow the following steps:
1. An admin user JWT is required in order create other account, use that token for authorization.
2. Send a POST request to the API endpoint.
3. Send a request body with the required fields.
4. A JSON Web Token(JWT) will be returned, which can be used for authorization during future API calls.

**Endpoint URL:** `/api/v1/auth/register`

**HTTP Method:** POST

**Description:** Register new users.

**Request Parameters:**
- Request Body

**Request Body:**
The request body for a POST request to register new users should be in JSON format and include the following fields:

- `username` (string, required): The username of the workshop/users.
- `password` (string, required): The password for the workshop/users.
- `admin` (boolean, required): The role of the user is admin or not(true or false).

**Response:**
- Status Code: 200 OK
- Response Body: JSON.

**Response Body:**
The response body includes the following fields:
- `token` (string): A JSON Web Token(JWT) that can be used to verify a user's identity in future API calls.

**Example Request:**

```http
POST /api/v1/auth/register
Content-Type: application/json
{
    "username": "workshop12",
    "password": "pass",
    "admin": false   
}
```

**Example Response:**
```http
HTTP/1.1 200 OK
Content-Type: application/json
{
    "token": "eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjpbeyJhdXRob3JpdHkiOiJST0xFX1VTRVIifV0sInN1YiI6IndvcmtzaG9wMTIiLCJpYXQiOjE2OTU1ODg1MzksImV4cCI6MTY5Njg4NDUzOX0.N6cfpqJnrnEX46cUvp3RAbnTd0dB1Jq7HUE-Q2msMcI"
}
```
<br>


## Excel Based Population

### Parts Table
This table has the list of all possible scopes of work that can be performed in a vehicle.

To populate the "parts" table using a Python script from an Excel file, follow the following steps:

1. Create an Excel file containing the data for the "parts" table.
2. Write a Python script to read data from the Excel file and insert it into the "parts" table.
3. Execute the python script to populate the "parts" table.

**Table Desc**<br>
The "parts" table has the following fields:
- `id` (int, auto generated): The id of the tuple(row) in the table. It is auto-generated by MySQL if null value is passed in its place.
- `part_code` (String, required): The part_code of that part. It is unique for each part.
- `item_name` (String, required): The name of that part.
- `price` (String, required): The price of that part.
- `hsn` (String, required): The hsn of that part.
- `tax` (String, required): The tax applicable on that part.

The following script can be used after making a few changes(like, csv file name, dbconfig): 
```python
import pandas as pd
import mysql.connector

# MySQL database connection settings
# The username and password of a db user with CRUD priveleges
db_config = {
    "host": "localhost",
    "user": "username",  
    "password": "password",
    "database": "dbName",
}

# Excel file path
excel_file = "parts.xlsx"

# Sheet name, the name of the sheet to look for in the excel workbook
sheet_name = "Sheet1"


# Connect to the MySQL database
try:
    connection = mysql.connector.connect(**db_config)
    cursor = connection.cursor()
except mysql.connector.Error as err:
    print("Error connecting to MySQL:", err)
    exit()



# Read Excel file using pandas
try:
    df = pd.read_excel(excel_file, sheet_name=sheet_name)

    # The name of the headings in the excel file(change based on excel file, order is important)
    df = df[["PART CODE", "ITEM NAME", "Revised Price Spectra", "HSN", "Tax Category(in %)"]]

    # Fill all null values with ""
    df = df.fillna("")
    
except Exception as e:
    print("Error reading Excel:", e)
    cursor.close()
    connection.close()
    exit()

# Convert the Excel data to a list of dictionaries
data_to_insert = df.to_dict(orient="records")
# print(data_to_insert)


# Insert data into the MySQL database
try:
    for row in data_to_insert:
        query = "INSERT INTO parts(part_code, item_name, price, hsn, tax) VALUES (%s, %s, %s, %s, %s)"
        values = tuple(row.values())
        # print(values)
        cursor.execute(query, values)
    connection.commit()
    print("Data inserted successfully.")
except mysql.connector.Error as err:
    print("Error inserting data into MySQL:", err)
    connection.rollback()




# Close the cursor and connection
cursor.close()
connection.close()
```
<br>

### AMC Table
This table has the id's of the AMC types, and their names.

To populate the "amc" table using a Python script from an Excel file, follow the following steps:

1. Create an Excel file containing the data for the "amc" table.
2. Write a Python script to read data from the Excel file and insert it into the "amc" table.
3. Execute the python script to populate the "amc" table.

**Table Desc**<br>
The "amc" table has the following fields:
- `id` (int, auto generated): The id of the tuple(row) in the table. It is auto-generated by MySQL if null value is passed in its place.
- `name` (String, required): The name of the AMC.
- `type` (String, required): The type of the AMC.

The following script can be used after making a few changes(like, csv file name, dbconfig): 
```python
import pandas as pd
import mysql.connector

# MySQL database connection settings
# The username and password of a db user with CRUD priveleges
db_config = {
    "host": "localhost",
    "user": "username",  
    "password": "password",
    "database": "dbName",
}

# Excel file path
excel_file = "amc.xlsx"

# Sheet name, the name of the sheet to look for in the excel workbook
sheet_name = "Sheet1"


# Connect to the MySQL database
try:
    connection = mysql.connector.connect(**db_config)
    cursor = connection.cursor()
except mysql.connector.Error as err:
    print("Error connecting to MySQL:", err)
    exit()



# Read Excel file using pandas
try:
    df = pd.read_excel(excel_file, sheet_name=sheet_name)

    # The name of the headings in the excel file(change based on excel file, order is important)
    df = df[["", "", ""]]

    # Fill all null values with ""
    df = df.fillna("")
    
except Exception as e:
    print("Error reading Excel:", e)
    cursor.close()
    connection.close()
    exit()

# Convert the Excel data to a list of dictionaries
data_to_insert = df.to_dict(orient="records")
# print(data_to_insert)


# Insert data into the MySQL database
try:
    for row in data_to_insert:
        query = "INSERT INTO amc(id, name, type) VALUES (%s, %s, %s)"
        values = tuple(row.values())
        # print(values)
        cursor.execute(query, values)
    connection.commit()
    print("Data inserted successfully.")
except mysql.connector.Error as err:
    print("Error inserting data into MySQL:", err)
    connection.rollback()




# Close the cursor and connection
cursor.close()
connection.close()
```
<br>

